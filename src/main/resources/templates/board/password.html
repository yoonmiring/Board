<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/board.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<!--haeder부분-->
<div th:insert="common/header.html" id="header"></div>

<div class="password">
    <input type="hidden" name="postId" th:value="${PostDto.id}"/>
    <form id="password-form">
        <label for="password">비밀번호를 입력하세요</label><br>
        <input type="password" id="password" name="password">
        <br><br>
        <input type="button" value="취소" onclick="history.back()">
        <button type="submit" class="edit-btn">확인</button>
    </form>
</div>

<!--footer부분-->
<div th:insert="common/footer.html" id="footer"></div>

<script>
    $(document).ready(function () {
        var post_id = $("[name=postId]").val();
        $.ajax({
            url: `/api/posts/${post_id}`,
            type: "GET",
            dataType: "json",
            success: function (data) {
                $(".post-title").text(data.title);
                $(".post-created-at").text(data.createdAt);
                $(".post-updated-at").text(data.updatedAt);
                $(".post-hits").text(data.hits);
                $(".post-username").text(data.username);
                $(".post-content").text(data.content);
            },
            error: function (xhr, status, error) {
                console.log(xhr);
                console.log(status);
                console.log(error);
            }
        });

        $('#password-form').submit(function (event) {
            event.preventDefault();
            var password = $('#password').val();

            $.ajax({
                type: 'POST',
                url: `/api/posts/${post_id}/verify-password`,
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({password: password}),
                success: function (result) {
                    if (result.success) {
                        window.location.href = '/posts/edit/' + post_id;
                    } else {
                        alert('비밀번호가 일치하지 않습니다. 다시 시도해주세요.');
                    }
                },
                error: function () {
                    alert('비밀번호 확인 중 오류가 발생했습니다.');
                }
            });
        });
    });
    // $("#edit-form").submit(function (event) {
    //     $.ajax({
    //         url: `/api/posts/edit/${id}`,
    //         method: "GET",
    //         success: function (response) {
    //             $("#post-title").val(response.title);
    //             $("#post-writer").val(response.writer);
    //             $("#post-content").val(response.content);
    //         },
    //         error: function (xhr, status, error) {
    //             console.log(error);
    //         }
    //     });
    // });
</script>
</body>
</html>